<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Volleyball Match Simulation Tools • volleysim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Volleyball Match Simulation Tools">
<meta property="og:description" content="Functions for simulating volleyball match outcomes.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">volleysim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="volleysim" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#volleysim" class="anchor"></a>volleysim</h1></div>
<!-- badges: start -->

<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## install.packages("remotes")</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"openvolley/volleysim"</span><span class="op">)</span></code></pre></div>
<p>The <code>volleysim</code> package provides functions for simulating sets and matches of volleyball. The simulation model can be parameterized in two ways:</p>
<ol>
<li><p>A simple “sideout” parameterization. We simply specify the sideout rate for each team. This can be a constant value (i.e. their average sideout rate) or can be provided as a function, allowing the sideout rate to vary depending on whatever factors you think might be appropriate. (Function-based parameterization is experimental: see <code><a href="reference/vs_simulate_set.html">help("vs_simulate_set")</a></code> for more information.)</p></li>
<li>
<p>A more detailed “phase” parameterization. In this model, we specify the rates for each team for:</p>
<ul>
<li>
<code>serve_ace</code> (serve ace rate)</li>
<li>
<code>serve_error</code> (serve error rate)</li>
<li>
<code>rec_set_error</code> (error rate on reception-phase sets)</li>
<li>
<code>rec_att_error</code> (error rate on reception-phase attacks)</li>
<li>
<code>rec_att_kill</code> (kill rate on reception-phase attacks)</li>
<li>
<code>rec_att_replayed</code> (rate at which reception-phase attacks are replayed by the attacking team for a second attack: either blocked for reattack, deliberately recycled off the block, or dug by the defending team but put back over as a freeball)</li>
<li>
<code>rec_block</code> (block kill rate against reception-phase attacks)</li>
<li>
<code>trans_set_error</code>, <code>trans_att_error</code>, <code>trans_att_kill</code>, <code>trans_att_replayed</code>, <code>trans_block</code> - as for the <code>rec_*</code> parameters, but in transition phase (i.e. everything after the reception-phase attack)</li>
</ul>
</li>
</ol>
</div>
<div id="example-1" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example 1</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">volleysim</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">datavolley</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="co">## read an example file</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datavolley/man/read_dv.html">dv_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/datavolley/man/dv_example_file.html">dv_example_file</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co">## calculate the rates we need to simulate</span>
<span class="va">rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vs_estimate_rates.html">vs_estimate_rates</a></span><span class="op">(</span><span class="va">x</span>, target_team <span class="op">=</span> <span class="st">"each"</span><span class="op">)</span>

<span class="fu"><a href="reference/vs_simulate_match.html">vs_simulate_match</a></span><span class="op">(</span><span class="va">rates</span><span class="op">)</span>
<span class="co">#&gt; $pwin</span>
<span class="co">#&gt; [1] 0.9850286</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores</span>
<span class="co">#&gt; $scores$`3-0`</span>
<span class="co">#&gt; [1] 0.7021917</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`3-1`</span>
<span class="co">#&gt; [1] 0.2341905</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`3-2`</span>
<span class="co">#&gt; [1] 0.0486464</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`2-3`</span>
<span class="co">#&gt; [1] 0.009934415</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`1-3`</span>
<span class="co">#&gt; [1] 0.003663221</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`0-3`</span>
<span class="co">#&gt; [1] 0.001373782</span></code></pre></div>
<p>So given the performances of the two teams during that match, we expect that the home team should have won, with 3-0 being the most likely scoreline. Compare this to the actual match result:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; Match summary:</span>
<span class="co">#&gt; Date: 2015-01-25</span>
<span class="co">#&gt; League: Finale mladinke</span>
<span class="co">#&gt; Teams: Braslovče (JERONČIČ ZORAN/MIHALINEC DAMIJANA)</span>
<span class="co">#&gt;        vs</span>
<span class="co">#&gt;        Nova KBM Branik (HAFNER MATJAŽ)</span>
<span class="co">#&gt; Result: 3-0 (25-16, 25-14, 25-22)</span>
<span class="co">#&gt; Duration: 67 minutes</span></code></pre></div>
</div>
<div id="example-2-exploring-match-options" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-exploring-match-options" class="anchor"></a>Example 2: exploring match options</h2>
<p>Let’s say we have two teams with the following season-average parameters:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="va">rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span><span class="op">~</span><span class="va">team</span>, <span class="op">~</span><span class="va">serve_ace</span>, <span class="op">~</span><span class="va">serve_error</span>, <span class="op">~</span><span class="va">rec_set_error</span>, <span class="op">~</span><span class="va">rec_att_error</span>, <span class="op">~</span><span class="va">rec_att_kill</span>, <span class="op">~</span><span class="va">rec_att_replayed</span>, <span class="op">~</span><span class="va">trans_set_error</span>, <span class="op">~</span><span class="va">trans_att_error</span>, <span class="op">~</span><span class="va">trans_att_kill</span>, <span class="op">~</span><span class="va">trans_att_replayed</span>, <span class="op">~</span><span class="va">sideout</span>, <span class="op">~</span><span class="va">rec_block</span>, <span class="op">~</span><span class="va">trans_block</span>,
<span class="st">"My team"</span>,    <span class="fl">0.062</span>, <span class="fl">0.156</span>, <span class="fl">0.009</span>, <span class="fl">0.071</span>, <span class="fl">0.499</span>, <span class="fl">0.05</span>, <span class="fl">0.018</span>, <span class="fl">0.082</span>, <span class="fl">0.452</span>, <span class="fl">0.05</span>, <span class="fl">0.668</span>, <span class="fl">0.075</span>, <span class="fl">0.079</span>,
<span class="st">"Other team"</span>, <span class="fl">0.069</span>, <span class="fl">0.190</span>, <span class="fl">0.014</span>, <span class="fl">0.063</span>, <span class="fl">0.523</span>, <span class="fl">0.05</span>, <span class="fl">0.021</span>, <span class="fl">0.102</span>, <span class="fl">0.435</span>, <span class="fl">0.05</span>, <span class="fl">0.683</span>, <span class="fl">0.083</span>, <span class="fl">0.109</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">rates</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="5%">
<col width="6%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="9%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="9%">
<col width="4%">
<col width="5%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">team</th>
<th align="right">serve_ace</th>
<th align="right">serve_error</th>
<th align="right">rec_set_error</th>
<th align="right">rec_att_error</th>
<th align="right">rec_att_kill</th>
<th align="right">rec_att_replayed</th>
<th align="right">trans_set_error</th>
<th align="right">trans_att_error</th>
<th align="right">trans_att_kill</th>
<th align="right">trans_att_replayed</th>
<th align="right">sideout</th>
<th align="right">rec_block</th>
<th align="right">trans_block</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">My team</td>
<td align="right">0.062</td>
<td align="right">0.156</td>
<td align="right">0.009</td>
<td align="right">0.071</td>
<td align="right">0.499</td>
<td align="right">0.05</td>
<td align="right">0.018</td>
<td align="right">0.082</td>
<td align="right">0.452</td>
<td align="right">0.05</td>
<td align="right">0.668</td>
<td align="right">0.075</td>
<td align="right">0.079</td>
</tr>
<tr class="even">
<td align="left">Other team</td>
<td align="right">0.069</td>
<td align="right">0.190</td>
<td align="right">0.014</td>
<td align="right">0.063</td>
<td align="right">0.523</td>
<td align="right">0.05</td>
<td align="right">0.021</td>
<td align="right">0.102</td>
<td align="right">0.435</td>
<td align="right">0.05</td>
<td align="right">0.683</td>
<td align="right">0.083</td>
<td align="right">0.109</td>
</tr>
</tbody>
</table>
<p>“My team” is due to play “Other team” in our next match. If we assume that both teams play to their season-average parameters, what outcome do we expect?</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/vs_simulate_match.html">vs_simulate_match</a></span><span class="op">(</span><span class="va">rates</span><span class="op">)</span>
<span class="co">#&gt; $pwin</span>
<span class="co">#&gt; [1] 0.4847279</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores</span>
<span class="co">#&gt; $scores$`3-0`</span>
<span class="co">#&gt; [1] 0.1185286</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`3-1`</span>
<span class="co">#&gt; [1] 0.1811204</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`3-2`</span>
<span class="co">#&gt; [1] 0.1850789</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`2-3`</span>
<span class="co">#&gt; [1] 0.1901302</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`1-3`</span>
<span class="co">#&gt; [1] 0.1938788</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`0-3`</span>
<span class="co">#&gt; [1] 0.131263</span></code></pre></div>
<p>Looks like we expect a close match, but My team is most probably going to lose.</p>
<p>Perhaps as the coach of My team there are some adjustments I could make — in choosing the players in our starting lineup, or in our match tactics. Can simulation help us explore which option might be most beneficial?</p>
<p>Let’s say that one of our options is to substitute in a different pass-hitter: Betty, who has a more aggressive serve and attack but who is a weaker passer than our starting pass-hitter Agnes. With Betty in the lineup instead of Agnes, we guesstimate our new team parameters to be:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rates2</span> <span class="op">&lt;-</span> <span class="va">rates</span>

<span class="co">## increase my team's serve aces and errors by 1% each, and attack kills by 2%</span>
<span class="va">rates2</span><span class="op">[</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"serve_ace"</span>, <span class="st">"serve_error"</span>, <span class="st">"rec_att_kill"</span>, <span class="st">"trans_att_kill"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span>
    <span class="va">rates2</span><span class="op">[</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"serve_ace"</span>, <span class="st">"serve_error"</span>, <span class="st">"rec_att_kill"</span>, <span class="st">"trans_att_kill"</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.02</span><span class="op">)</span>

<span class="co">## increase opposition serve aces by 1%</span>
<span class="va">rates2</span><span class="op">[</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"serve_ace"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rates2</span><span class="op">[</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"serve_ace"</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.01</span>

<span class="fu"><a href="reference/vs_simulate_match.html">vs_simulate_match</a></span><span class="op">(</span><span class="va">rates2</span><span class="op">)</span>
<span class="co">#&gt; $pwin</span>
<span class="co">#&gt; [1] 0.5389318</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores</span>
<span class="co">#&gt; $scores$`3-0`</span>
<span class="co">#&gt; [1] 0.1417528</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`3-1`</span>
<span class="co">#&gt; [1] 0.2037515</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`3-2`</span>
<span class="co">#&gt; [1] 0.1934275</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`2-3`</span>
<span class="co">#&gt; [1] 0.1805792</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`1-3`</span>
<span class="co">#&gt; [1] 0.1712485</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`0-3`</span>
<span class="co">#&gt; [1] 0.1092405</span></code></pre></div>
<p>That makes a slight improvement. Our second option is to change our serving tactics: we will serve more aggressively in order to put more pressure on Other team’s reception but accepting that we will make more serve errors in doing so:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rates3</span> <span class="op">&lt;-</span> <span class="va">rates</span>

<span class="co">## increase my team's serve aces by 2% and errors by 5%</span>
<span class="va">rates3</span><span class="op">[</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"serve_ace"</span>, <span class="st">"serve_error"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rates3</span><span class="op">[</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"serve_ace"</span>, <span class="st">"serve_error"</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.05</span><span class="op">)</span>

<span class="co">## decrease opposition reception kills by 5% due to their expected poorer passing</span>
<span class="va">rates3</span><span class="op">[</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rec_att_kill"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rates3</span><span class="op">[</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rec_att_kill"</span><span class="op">)</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.05</span>
<span class="fu"><a href="reference/vs_simulate_match.html">vs_simulate_match</a></span><span class="op">(</span><span class="va">rates3</span><span class="op">)</span>
<span class="co">#&gt; $pwin</span>
<span class="co">#&gt; [1] 0.5791922</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores</span>
<span class="co">#&gt; $scores$`3-0`</span>
<span class="co">#&gt; [1] 0.161008</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`3-1`</span>
<span class="co">#&gt; [1] 0.22047</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`3-2`</span>
<span class="co">#&gt; [1] 0.1977142</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`2-3`</span>
<span class="co">#&gt; [1] 0.1718007</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`1-3`</span>
<span class="co">#&gt; [1] 0.1545149</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`0-3`</span>
<span class="co">#&gt; [1] 0.09449215</span></code></pre></div>
<p>This looks like it might be a better option (assuming, of course, that we have estimated the changes in rates correctly).</p>
</div>
<div id="example-3" class="section level2">
<h2 class="hasAnchor">
<a href="#example-3" class="anchor"></a>Example 3</h2>
<p>Let’s look at another match: the 2020 Austrian Women’s Volley Cup played between Hartberg and UVC Graz (the dvw file was downloaded from <a href="https://www.volleynet.at/dvdownload/information/f-Damen/" class="uri">https://www.volleynet.at/dvdownload/information/f-Damen/</a> and is bundled with the volleysim package). UVC Graz won the match 3-1:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datavolley/man/read_dv.html">dv_read</a></span><span class="op">(</span><span class="fu"><a href="reference/vs_example_file.html">vs_example_file</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; Match summary:</span>
<span class="co">#&gt; Date: 2020-11-08</span>
<span class="co">#&gt; League: Austrian Volley Cup Women 2020/21 - DCup</span>
<span class="co">#&gt; Teams: Hartberg w Cup (BEINSEN Birgit/ALMER Katharina)</span>
<span class="co">#&gt;        vs</span>
<span class="co">#&gt;        UVC Graz w Cup (PACK Matthias/APPEL Martin)</span>
<span class="co">#&gt; Result: 1-3 (21-25, 21-25, 25-20, 15-25)</span>
<span class="co">#&gt; Duration: 88 minutes</span></code></pre></div>
<p>Let’s see what result we expected given the team’s actual performances during the match:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="reference/vs_estimate_rates.html">vs_estimate_rates</a></span><span class="op">(</span><span class="va">x</span>, target_team <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/datavolley/man/teams.html">home_team</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,
              <span class="fu"><a href="reference/vs_estimate_rates.html">vs_estimate_rates</a></span><span class="op">(</span><span class="va">x</span>, target_team <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/datavolley/man/teams.html">visiting_team</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">sim_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vs_simulate_match.html">vs_simulate_match</a></span><span class="op">(</span>rates <span class="op">=</span> <span class="va">rates</span><span class="op">)</span>
<span class="va">sim_result</span>
<span class="co">#&gt; $pwin</span>
<span class="co">#&gt; [1] 0.314285</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores</span>
<span class="co">#&gt; $scores$`3-0`</span>
<span class="co">#&gt; [1] 0.06099924</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`3-1`</span>
<span class="co">#&gt; [1] 0.1110245</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`3-2`</span>
<span class="co">#&gt; [1] 0.1422613</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`2-3`</span>
<span class="co">#&gt; [1] 0.1998572</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`1-3`</span>
<span class="co">#&gt; [1] 0.2632404</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`0-3`</span>
<span class="co">#&gt; [1] 0.2226173</span></code></pre></div>
<p>The simulations suggest that Hartberg had a 31.4% chance of winning, with the most likely scoreline being 1-3 — consistent with the actual result.</p>
<p>Now let’s say that the two teams will be playing again soon, and the Hartberg coach thinks that their first-ball attack could be improved by improving their passing. What difference might we expect in the match outcome for an improvement in this area?</p>
<p>First let’s get a handle on the relevant performance parameters. “Positive” passes here means passes that were rated as perfect or positive.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## extract the play-by-play data</span>
<span class="va">xp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/datavolley/man/plays.html">plays</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>

<span class="co">## identify first-ball attacks</span>
<span class="va">fba</span> <span class="op">&lt;-</span> <span class="va">xp</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">skill</span> <span class="op">==</span> <span class="st">"Attack"</span> <span class="op">&amp;</span> <span class="va">phase</span> <span class="op">==</span> <span class="st">"Reception"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>made_attack <span class="op">=</span> <span class="cn">TRUE</span>, fbso <span class="op">=</span> <span class="va">evaluation</span> <span class="op">==</span> <span class="st">"Winning attack"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">point_id</span>, <span class="va">team</span>, <span class="va">made_attack</span>, <span class="va">fbso</span><span class="op">)</span>

<span class="co">## join that back to the full play-by-play data</span>
<span class="va">xp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">xp</span>, <span class="va">fba</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"point_id"</span>, <span class="st">"team"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fbso <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fbso</span><span class="op">)</span>, <span class="cn">FALSE</span>, <span class="va">fbso</span><span class="op">)</span>,
           made_attack <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">made_attack</span><span class="op">)</span>, <span class="cn">FALSE</span>, <span class="va">made_attack</span><span class="op">)</span><span class="op">)</span>

<span class="co">## and pass quality on each rally</span>
<span class="va">pq</span> <span class="op">&lt;-</span> <span class="va">xp</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">skill</span> <span class="op">==</span> <span class="st">"Reception"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">point_id</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>pass_quality <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">evaluation</span><span class="op">)</span><span class="op">)</span>
<span class="va">xp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">xp</span>, <span class="va">pq</span>, by <span class="op">=</span> <span class="st">"point_id"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pass_quality <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Perfect|Positive"</span>, <span class="va">pass_quality</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Positive"</span>,
                                    <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Error"</span>, <span class="va">pass_quality</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Error"</span>,
                                    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## finally summarize the first-ball attacks by pass quality</span>
<span class="va">fb_summary</span> <span class="op">&lt;-</span> <span class="va">xp</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">skill</span> <span class="op">==</span> <span class="st">"Reception"</span> <span class="op">&amp;</span> <span class="va">team</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/pkg/datavolley/man/teams.html">home_team</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">pass_quality</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,
                                                `Attack %` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">made_attack</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>,
                                                `Attack kill %` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">fbso</span><span class="op">[</span><span class="va">made_attack</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>,
                                                `FBSO%` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">fbso</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>
<span class="va">fb_summary</span>
<span class="co">#&gt; # A tibble: 3 x 5</span>
<span class="co">#&gt;   pass_quality     N `Attack %` `Attack kill %` `FBSO%`</span>
<span class="co">#&gt; * &lt;chr&gt;        &lt;int&gt;      &lt;dbl&gt;           &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Error            3        0             NaN       0  </span>
<span class="co">#&gt; 2 Other           26       61.5            18.8    11.5</span>
<span class="co">#&gt; 3 Positive        49       87.8            41.9    36.7</span></code></pre></div>
<p>Hartberg made 49 positive passes (62.8% positive pass rate). They made an actual attack on 87.8% of those positive passes, with a kill rate of 41.9% on those attacks. Their overall first-ball sideout rate on positive passes was 36.7%.</p>
<p>On other passes (excluding pass errors), Hartberg’s first-attack sideout rate was 11.5%, with only 61.5% of those passes leading to an attack, and a kill rate of 18.8% on those attacks.</p>
<p>Let’s say that with some focused training, the Hartberg coach thinks that their positive pass rate can be substantially increased, from 62.8% to 75%. This would change their reception attack kill rate, because more attacks would be made from positive passes. The expected reception attack kill rate would be the weighted average of the kill rates on positive and other passes (where the weights are the relative numbers of positive and other passes).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_positive_pass_rate</span> <span class="op">&lt;-</span> <span class="fl">0.75</span>
<span class="va">attack_rate_pos</span> <span class="op">&lt;-</span> <span class="va">new_positive_pass_rate</span> <span class="op">*</span> <span class="fl">0.878</span>
<span class="va">attack_rate_other</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">new_positive_pass_rate</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.615</span>
<span class="va">new_rec_att_kill</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">attack_rate_pos</span> <span class="op">*</span> <span class="fl">0.419</span> <span class="op">+</span> <span class="co">## positive pass rate multiplied by their corresponding kill rate</span>
                     <span class="va">attack_rate_other</span> <span class="op">*</span> <span class="fl">0.188</span> <span class="co">## attack rate on other passes * their kill rate</span>
                     <span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">attack_rate_pos</span> <span class="op">+</span> <span class="va">attack_rate_other</span><span class="op">)</span>
<span class="va">new_rec_att_kill</span>
<span class="co">#&gt; [1] 0.3752742</span></code></pre></div>
<p>That is, with the hypothesized better passing performance we expect only a modest increase in the overall reception attack kill rate to 37.5% (up from 35.6%).</p>
<p>Armed with that estimate, we can explore what effect that might have on a re-match:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rates</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">rec_att_kill</span> <span class="op">&lt;-</span> <span class="va">new_rec_att_kill</span>
<span class="va">new_sim_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vs_simulate_match.html">vs_simulate_match</a></span><span class="op">(</span>rates <span class="op">=</span> <span class="va">rates</span><span class="op">)</span>
<span class="va">new_sim_result</span>
<span class="co">#&gt; $pwin</span>
<span class="co">#&gt; [1] 0.3582752</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores</span>
<span class="co">#&gt; $scores$`3-0`</span>
<span class="co">#&gt; [1] 0.07394493</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`3-1`</span>
<span class="co">#&gt; [1] 0.1288044</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`3-2`</span>
<span class="co">#&gt; [1] 0.1555258</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`2-3`</span>
<span class="co">#&gt; [1] 0.2006886</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`1-3`</span>
<span class="co">#&gt; [1] 0.2459659</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scores$`0-3`</span>
<span class="co">#&gt; [1] 0.1950702</span></code></pre></div>
<p>Giving a match win probability of 35.8% (up from 31.4%).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Ben Raymond <br><small class="roles"> Author, maintainer </small>  </li>
<li>Dwight Wynne <br><small class="roles"> Author </small>  </li>
<li>Adrien Ickowicz <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="lifecycle"></a></li>
<li><a href="https://github.com/openvolley/volleysim/actions"><img src="https://github.com/openvolley/volleysim/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Ben Raymond, Dwight Wynne, Adrien Ickowicz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
